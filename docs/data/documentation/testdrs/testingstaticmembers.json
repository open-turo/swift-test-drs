{"primaryContentSections":[{"content":[{"level":2,"text":"Overview","type":"heading","anchor":"Overview"},{"type":"paragraph","inlineContent":[{"text":"This article explains how to test code that interacts with static properties and methods by using TestDRS to create mocks. When your code uses types with static members, you can replace those types with TestDRS mocks to verify interactions and control behavior in your tests.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"TestDRS provides the ","type":"text"},{"code":"withStaticTestingContext","type":"codeVoice"},{"type":"text","text":" function to isolate static state between tests, ensuring that each test starts with a clean slate."}]},{"inlineContent":[{"text":"This article covers:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"The challenges of testing static members","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Using "},{"type":"codeVoice","code":"withStaticTestingContext"},{"type":"text","text":" to isolate tests"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Mocking static methods"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Verifying static method calls"}],"type":"paragraph"}]}],"type":"orderedList"},{"type":"heading","text":"The Challenge with static members","anchor":"The-Challenge-with-static-members","level":2},{"inlineContent":[{"text":"Static properties and methods in Swift are shared across all instances of a class or struct. This means that changes made in one test can affect other tests:","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["class AuthService {","    static var currentUser: User?","    ","    static func isUserLoggedIn() -> Bool {","        return currentUser != nil","    }","    ","    static func currentUserRole() -> String {","        return currentUser?.role ?? \"guest\"","    }","}","","class AuthServiceTests: XCTestCase {","    func testIsUserLoggedIn_WhenUserExists() {","        \/\/ This test sets a user","        AuthService.currentUser = User(id: \"123\", role: \"admin\")","        XCTAssertTrue(AuthService.isUserLoggedIn())","    }","    ","    func testCurrentUserRole_WhenNoUser() {","        \/\/ This assumes no user is set, but might run after the previous test","        \/\/ which would cause this test to fail unexpectedly","        XCTAssertEqual(AuthService.currentUserRole(), \"guest\")","    }","}"]},{"type":"heading","level":2,"text":"Using `withStaticTestingContext`","anchor":"Using-withStaticTestingContext"},{"inlineContent":[{"text":"TestDRS provides ","type":"text"},{"type":"codeVoice","code":"withStaticTestingContext"},{"text":" to isolate static state between tests. This function creates a fresh context for each test, preventing side effects from affecting other tests.","type":"text"}],"type":"paragraph"},{"anchor":"Basic-Usage","type":"heading","text":"Basic Usage","level":3},{"inlineContent":[{"type":"text","text":"Wrap your test logic in a call to "},{"type":"codeVoice","code":"withStaticTestingContext"},{"text":":","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["func testStaticLogger() {","    withStaticTestingContext {","        \/\/ Test static members here","        \/\/ ...","    }","}"]},{"text":"Integrating with XCTest","level":3,"anchor":"Integrating-with-XCTest","type":"heading"},{"inlineContent":[{"text":"For test cases that primarily test static members, you can override ","type":"text"},{"code":"invokeTest","type":"codeVoice"},{"text":" to ensure every test method runs in its own static testing context:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["class StaticMemberTests: XCTestCase {","    override func invokeTest() {","        withStaticTestingContext {","            super.invokeTest()","        }","    }","    ","    func testStaticMethod1() {","        \/\/ This test now runs in its own static testing context","    }","    ","    func testStaticMethod2() {","        \/\/ This test also runs in its own static testing context,","        \/\/ unaffected by testStaticMethod1","    }","}"],"type":"codeListing"},{"type":"heading","anchor":"Creating-testable-static-members","text":"Creating testable static members","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"To make static members testable with TestDRS, you can simply use one of the macros that generates a mock type, like "},{"code":"@AddMock","type":"codeVoice"},{"type":"text","text":":"}]},{"syntax":"swift","code":["@AddMock","class AuthService {","    ...","}"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The generated "},{"code":"MockAuthService","type":"codeVoice"},{"text":" will conform to ","type":"text"},{"type":"codeVoice","code":"StaticTestable"},{"type":"text","text":", allowing you to test its static methods. You can stub and verify calls using the same macros you use for instance members:"}]},{"syntax":"swift","code":["class FeatureManager {","    func canAccessAdminFeature() -> Bool {","        guard AuthService.isUserLoggedIn() else {","            return false","        }","        ","        return AuthService.currentUserRole() == \"admin\"","    }","}","","@Test","func testCanAccessAdminFeature() throws {","    withStaticTestingContext {","        \/\/ Set the mock as the dependency","        Dependencies.authService = MockAuthService.self","        ","        \/\/ Stub the static methods","        #stub(MockAuthService.isUserLoggedIn, returning: true)","        #stub(MockAuthService.currentUserRole, returning: \"admin\")","        ","        let featureManager = FeatureManager()","","        #expect(featureManager.canAccessAdminFeature())","        ","        \/\/ Verify the static methods were called","        #expectWasCalled(MockAuthService.isUserLoggedIn).exactlyOnce()","        #expectWasCalled(MockAuthService.currentUserRole).exactlyOnce()","    }","}"],"type":"codeListing"},{"text":"Limitations","anchor":"Limitations","level":2,"type":"heading"},{"inlineContent":[{"type":"text","text":"The "},{"code":"withStaticTestingContext","type":"codeVoice"},{"text":" function uses TaskLocal values to maintain context, which ensures thread safety within the Swift Concurrency model. However, there are some limitations:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Detached "},{"type":"codeVoice","code":"Task"},{"text":"s won’t inherit the static testing context","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Code running on different threads via GCD or other non-Swift Concurrency mechanisms won’t have access to the context"}]}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If your code creates detached tasks or uses other threading mechanisms, you will get test failures and\/or fatal errors when using static members of a TestDRS mock type."}]},{"level":2,"anchor":"Summary","text":"Summary","type":"heading"},{"inlineContent":[{"text":"TestDRS makes testing code that uses static members straightforward:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Use ","type":"text"},{"code":"withStaticTestingContext","type":"codeVoice"},{"type":"text","text":" to isolate static state between tests"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Create mock types with "},{"code":"@AddMock","type":"codeVoice"},{"type":"text","text":" or "},{"type":"codeVoice","code":"@Mock"},{"type":"text","text":" that automatically conform to "},{"type":"codeVoice","code":"StaticTestable"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Stub and verify static methods using the same macros you use for instance methods"}],"type":"paragraph"}]}],"type":"orderedList"},{"type":"paragraph","inlineContent":[{"text":"This approach ensures reliable, isolated tests for code that interacts with static members.","type":"text"}]}],"kind":"content"}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/testdrs\/testingstaticmembers"]}],"sections":[],"schemaVersion":{"minor":3,"major":0,"patch":0},"hierarchy":{"paths":[["doc:\/\/TestDRS\/documentation\/TestDRS"]]},"abstract":[{"text":"Learn how to test code that uses static members by creating mocks with TestDRS.","type":"text"}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/TestDRS\/documentation\/TestDRS\/TestingStaticMembers"},"seeAlsoSections":[{"title":"Additional testing topics","anchor":"Additional-testing-topics","generated":true,"identifiers":["doc:\/\/TestDRS\/documentation\/TestDRS\/FAQ"]}],"kind":"article","metadata":{"modules":[{"name":"TestDRS"}],"title":"Testing static members","role":"article","roleHeading":"Article"},"references":{"doc://TestDRS/documentation/TestDRS/FAQ":{"kind":"article","role":"article","url":"\/documentation\/testdrs\/faq","title":"Frequently Asked Questions","abstract":[{"type":"text","text":"Common questions and answers about using TestDRS."}],"identifier":"doc:\/\/TestDRS\/documentation\/TestDRS\/FAQ","type":"topic"},"doc://TestDRS/documentation/TestDRS":{"title":"TestDRS","type":"topic","url":"\/documentation\/testdrs","abstract":[{"type":"text","text":"A modern Swift testing library that provides powerful mocking, stubbing, and verification capabilities through Swift macros."}],"kind":"symbol","identifier":"doc:\/\/TestDRS\/documentation\/TestDRS","role":"collection"}}}